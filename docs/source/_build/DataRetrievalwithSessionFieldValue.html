<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Retrieval with Session Field variables &mdash; NovalandGuide 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Election" href="Election.html" />
    <link rel="prev" title="Bank Account" href="BankAccount.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> NovalandGuide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="PyCharmOverview.html">PyCharmOverview</a></li>
<li class="toctree-l1"><a class="reference internal" href="CreateANewApp.html">Create a new app</a></li>
<li class="toctree-l1"><a class="reference internal" href="otreeProject.html">oTree Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="CreateANewPage.html">Create a new page</a></li>
<li class="toctree-l1"><a class="reference internal" href="BasicStructureOfAPage.html">Basic structure of the page</a></li>
<li class="toctree-l1"><a class="reference internal" href="Buttons.html">Buttons</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicText.html">Dynamic Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="WaitPages.html">Wait Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="AddPictures.html">Add Pictures</a></li>
<li class="toctree-l1"><a class="reference internal" href="ModifyingHTML.html">Modifying HTML with JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="SendDataLive.html">Send Data with a live Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="RandomiseValues.html">Randomise Values for the participant</a></li>
<li class="toctree-l1"><a class="reference internal" href="BankAccount.html">Bank Account</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Retrieval with Session Field variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#collecting-donations-and-distributing-them-evenly-among-those-affected">Collecting donations and distributing them evenly among those affected.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#donation">Donation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-friendly-elements">User friendly elements</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Election.html">Election</a></li>
<li class="toctree-l1"><a class="reference internal" href="Heroku.html">Heroku</a></li>
<li class="toctree-l1"><a class="reference internal" href="IndividualSettingsForTheSession.html">Individual settings for the session:</a></li>
<li class="toctree-l1"><a class="reference internal" href="DataCollection.html">Data Collection</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NovalandGuide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Data Retrieval with Session Field variables</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/DataRetrievalwithSessionFieldValue.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="data-retrieval-with-session-field-variables">
<h1>Data Retrieval with Session Field variables<a class="headerlink" href="#data-retrieval-with-session-field-variables" title="Permalink to this heading"></a></h1>
<p>Novaland is a study where it is important that the decisions of all participants are taken into account and can be incorporated.
Therefore, we need variables in the project that can be edited and accessed by all participants. This is where session field variables come into play, as they can be accessed by all participants across all apps.</p>
<p>The usage of SESSION_FIELDS has already been explained in #otreeProject.
In this chapter, we will show how all participants can edit certain variables so that other parts of the project can be modified accordingly.</p>
<section id="collecting-donations-and-distributing-them-evenly-among-those-affected">
<h2>Collecting donations and distributing them evenly among those affected.<a class="headerlink" href="#collecting-donations-and-distributing-them-evenly-among-those-affected" title="Permalink to this heading"></a></h2>
<p>In this chapter, we discuss the example of a fire in Novaland that has affected a portion of the society, causing them to lose some of their savings.
Participants can now donate money to help those affected.
The total amount of money donated will be stored in a variable and divided by the number of affected individuals.</p>
<p>To determine the number of affected individuals, we use an if function to ask each participant whether they are listed in the CSV file as being affected or not. If they are affected, we use a try and except function to test whether the variable has already been queried in the session fields.
This is important because the session field variable may not be defined and attempting to access it can cause an error.
If the variable is undefined, we set it to 1, and if it is defined, we increment the value by 1.
We also refer to participants who were not affected by the fire as “unaffected” in the data.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">class Phase_4_Page_9(Page): # Example Page</span>
<span class="go">    @staticmethod</span>
<span class="go">    def vars_for_template(player: Player):</span>
<span class="go">        if player.participant.CSVFireAffected == 1: # Query whether fire affected</span>
<span class="go">            player.participant.FireAffected = &quot;Ja&quot;</span>
<span class="go">            try: # The query whether the session field already exists</span>
<span class="go">                player.session.FireAffected = player.session.FireAffected + 1</span>
<span class="go">            except KeyError: # If the session field is not defined yet an error appears, if this error occurs we give the session field the value 1</span>
<span class="go">                player.session.FireAffected = 1</span>
<span class="go">        if player.participant.CSVFireAffected == 0:</span>
<span class="go">            player.participant.FireAffected = &quot;Nein&quot;</span>
</pre></div>
</div>
<p>Each time a fire affected participant has now arrived at this point from the app, the value increases by 1.</p>
<section id="donation">
<h3>Donation<a class="headerlink" href="#donation" title="Permalink to this heading"></a></h3>
<p>For donations, we use the same process as before, except this time we increment the SESSION FIELD value by the amount of the donation.
To enable participants to donate, we add a donation field to one of our pages.</p>
<p>We create various scenarios in which the bank account plays a crucial role.
To use the bank account, we need to make the variables from the Python backend available to the HTML page:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">@staticmethod</span>
<span class="go">def js_vars(player: Player): # This is released especially for the JavaScript area.</span>
<span class="go">    return {</span>
<span class="go">        &quot;BankBalance&quot;: player.BankBalance,</span>
<span class="go">    }</span>
</pre></div>
</div>
<p>We will now create a donation field using an input field, which will recognize the input of the participants.
We also limit the field to only accept positive numbers.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;input id=&quot;Donation&quot; type=&quot;number&quot; pattern=&quot;[0-9]*&quot; step=&quot;1&quot; min=&quot;0&quot; oninput=&quot;this.value = Math.abs(this.value)&quot;&gt;</span>
</pre></div>
</div>
<p>Next, we will add a button that allows reading the entered number and sending it to the backend to be stored.
To do this, we first add the functions to the HTML page.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;input id=&quot;DonationID&quot; type=&quot;number&quot; pattern=&quot;[0-9]*&quot; step=&quot;1&quot; min=&quot;0&quot; oninput=&quot;this.value = Math.abs(this.value)&quot;&gt;</span>
<span class="go">&lt;br&gt;</span>
<span class="go">&lt;button class=&quot;button&quot; type=&quot;button&quot; onclick=&quot;DonationFunction()&quot;&gt; Donation&lt;/button&gt;    # Button with the function &#39;DonationFunction()&#39;, which is triggered when the button is pressed.</span>

<span class="go">{% block script %}</span>
<span class="go">&lt;script&gt;</span>
<span class="go">BankBalance = js_vars.BankBalance     # We retrieve the account that we have defined above</span>

<span class="go">function DonationFunction(){</span>
<span class="go">    let DonationValue = document.getElementById(&quot;DonationID&quot;).value     # With the id &#39;DonationID&#39;, which we have given to the Input Field, we get Value of the input</span>
<span class="go">    liveSend({&quot;Donation&quot;: &quot;DonationNumber&quot;, &quot;DonationNumber&quot;: DonationValue});  # Then we send this value with the Live Send function to the backend</span>
<span class="go">    }</span>
</pre></div>
</div>
<p>In the backend, we will then access this variable using a live_method:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">@staticmethod</span>
<span class="go">def live_method(player: Player, data):</span>
<span class="go">    if &quot;Donation&quot; in data:      # If &#39;Donation&#39; occurs in data then this if function is triggered</span>
<span class="go">        player.Donation = float(data[&quot;DonationNumber&quot;])     # Of course, we must have defined the variable &#39;Donation&#39; in the player model in advance, so that we can now give it a value.</span>
<span class="go">        player.BankBalanceNew = player.BankBalance - player.Donation      # We also define a new Bank Balance value, which reflects the old Bank Balance but with deduction of the donation.</span>
</pre></div>
</div>
</section>
<section id="user-friendly-elements">
<h3>User friendly elements<a class="headerlink" href="#user-friendly-elements" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt>We are adding user-friendly attributes and functions, such as:</dt><dd><ul class="simple">
<li><p>Placing the input field within a query text</p></li>
<li><p>Displaying the bank account before and after the donation input</p></li>
<li><p>Showing a message under the donation input, notifying participants that they do not have enough funds</p></li>
<li><p>Allowing participants who do not wish to donate to simply click on the “next” button.</p></li>
</ul>
</dd>
</dl>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;div id=&quot;Delete&quot;&gt;</span>
<span class="go">&lt;p class=&quot;p&quot;&gt;Donation question:</span>
<span class="go">     I will donate &lt;input id=&quot;DonationID&quot; type=&quot;number&quot; pattern=&quot;[0-9]*&quot; step=&quot;1&quot; min=&quot;0&quot; oninput=&quot;this.value = Math.abs(this.value)&quot;&gt; Novas &lt;/p&gt;</span>
<span class="go">    {% if player.BankBalance &lt;= 0 %}&lt;br&gt;If you have &lt;strong&gt;no&lt;/strong&gt; funds left, please enter &lt;strong&gt;0&lt;/strong&gt; in the field.{% endif %}</span>
<span class="go">            &lt;br&gt;</span>
<span class="go">            &lt;br&gt;</span>
<span class="go">            &lt;button class=&quot;button&quot; type=&quot;button&quot; onclick=&quot;DonationFunction()&quot;&gt; Donation&lt;/button&gt;</span>
<span class="go">    &lt;/div&gt;</span>
<span class="go">    &lt;br&gt;</span>
<span class="go">    &lt;div id=&quot;NotEnough&quot;&gt;</span>
<span class="go">    &lt;/div&gt;</span>

<span class="go">{% block script %}</span>
<span class="go">&lt;script&gt;</span>
<span class="go">BankBalance = js_vars.BankBalance</span>

<span class="go">function DonationFunction(){</span>
<span class="go">    let DonationValue = document.getElementById(&quot;DonationID&quot;).value</span>
<span class="go">    if(!DonationValue){DonationValue = 0}</span>
<span class="go">    liveSend({&quot;Donation&quot;: &quot;DonationNumber&quot;, &quot;DonationNumber&quot;: DonationValue});</span>
<span class="go">    BankBalanceNew = BankBalance - DonationValue;</span>
<span class="go">    if (BankBalanceNew &gt;= 0 || DonationValue == 0) {</span>
<span class="go">        document.getElementById(&quot;Delete&quot;).innerHTML = &quot;&lt;p class=&#39;p&#39;&gt;&quot; + &quot;You donated &quot; + &quot;&lt;strong&gt;&quot; + Donation + &quot; Novas&quot; + &quot;&lt;/strong&gt;&quot; + &quot; Novas&quot; + &quot;&lt;br&gt;&quot; + &quot;You still have &quot; +&quot;&lt;strong&gt;&quot; + BankBalanceNew + &quot; Novas&quot; + &quot;&lt;/strong&gt;&quot; + &quot; left.&quot; + &quot;&lt;/p&gt;&quot; + &quot;&lt;button class=&#39;button&#39; type=&#39;button&#39; onclick=&#39;Next()&#39;&gt; Continue &lt;/button&gt;&quot;;</span>
<span class="go">        document.getElementById(&quot;NotEnough&quot;).innerHTML = &quot; &quot;;</span>
<span class="go">    }</span>
<span class="go">    if (NachDonation &lt; 0 &amp;&amp; DonationValue &gt; 0) {</span>
<span class="go">        document.getElementById(&quot;NotEnough&quot;).innerHTML = &quot;&lt;p class=&#39;p&#39;&gt;&quot; + &quot;You cannot donate more money than you have.&quot; + &quot;&lt;/p&gt;&quot;;</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="BankAccount.html" class="btn btn-neutral float-left" title="Bank Account" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Election.html" class="btn btn-neutral float-right" title="Election" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, University Duisburg.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>